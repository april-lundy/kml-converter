<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.css" />
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
        <style>
            #map {
                height: 400px;
                width: 800px;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        <script src="http://cdn.jsdelivr.net/leaflet.esri/1.0.0/esri-leaflet.js"></script>
        <script>
        // parse the hash to get points
        var polygons = decodeURIComponent(window.location.hash.substring(1));
        if(polygons.length < 2) {
            polygons = '[]';
        }
        polygons = JSON.parse(polygons);

        // Stub out a map
        var map = L.map('map', { zoomControl: false }).setView([38.03333333,-98.583333333], 4);
        L.tileLayer('http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png', {          
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // map the points to the format that leaflet wants, and add to the map
        var pointToLeafletPoint = function(point) { return [Number(point.x), Number(point.y)]; };
        var polygonToLeafletPolygon = function(polygon) { return polygon.map(pointToLeafletPoint); };
        polygons.map(polygonToLeafletPolygon).forEach(function(leafletPolygon) {
          var polygon = L.polygon(leafletPolygon);
          polygon.fill = true;
          polygon.fillColor = 'red';
          polygon.addTo(map);
        });

        // add a scale to show
        L.control.scale().addTo(map);
        </script>
    </body>
</html>
